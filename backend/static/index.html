<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Handwritten OCR Studio</title>

  <style>
    :root {
      --bg: #020617;
      --card: rgba(255, 255, 255, 0.08);
      --accent: #38bdf8;
      --text: #e5e7eb;
      --muted: #9ca3af;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #020617, #0f172a);
      font-family: "Segoe UI", system-ui, sans-serif;
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 40px 16px;
    }

    .app {
      width: 100%;
      max-width: 1100px;
    }

    h1 {
      font-weight: 700;
      margin-bottom: 6px;
    }

    .subtitle {
      color: var(--muted);
      margin-bottom: 30px;
    }

    .card {
      background: var(--card);
      backdrop-filter: blur(14px);
      border-radius: 18px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    form.upload-area {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }

    input[type="file"] {
      color: var(--muted);
    }

    button {
      background: var(--accent);
      color: #020617;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(56,189,248,0.4);
    }

    button.secondary {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
    }

    .status {
      margin-top: 12px;
      font-size: 14px;
      color: var(--muted);
    }

    .page {
      margin-top: 20px;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    textarea {
      width: 100%;
      min-height: 140px;
      background: rgba(0,0,0,0.3);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 12px;
      padding: 12px;
      resize: vertical;
      font-size: 14px;
      line-height: 1.5;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    .merged {
      min-height: 220px;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      font-size: 13px;
      color: var(--muted);
    }
  </style>
</head>

<body>
  <div class="app">

    <h1>üìù Handwritten OCR Studio</h1>
    <div class="subtitle">
      Upload handwritten notes ‚Üí get clean, editable digital text
    </div>

    <!-- Upload Card -->
    <div class="card">
      <form class="upload-area" onsubmit="handleSubmit(event)">
        <input type="file" id="files" multiple />
        <button type="submit">Extract Text</button>
      </form>
      <div class="status" id="status"></div>
    </div>

    <!-- Results -->
    <div id="results"></div>

    <div class="footer">
      Built with FastAPI + OpenCV + OCR | Internship Project
    </div>

  </div>

  <script>
    function handleSubmit(event) {
      event.preventDefault();   // üö´ stop page refresh
      upload();
    }

    async function upload() {
      const input = document.getElementById("files");
      const status = document.getElementById("status");
      const results = document.getElementById("results");

      if (input.files.length === 0) {
        alert("Please select one or more images");
        return;
      }

      status.textContent = "Processing images‚Ä¶";
      results.innerHTML = "";

      const formData = new FormData();
      for (let file of input.files) {
        formData.append("files", file); // MUST be "files"
      }

      try {
        // üîë KEY CHANGE: relative API path
        const response = await fetch("/ocr", {
          method: "POST",
          body: formData
        });

        const data = await response.json();

        if (!data.pages) {
          status.textContent = "Unexpected backend response";
          console.error(data);
          return;
        }

        status.textContent = `Processed ${data.pages.length} page(s)`;

        let mergedText = "";

        data.pages.forEach((page, index) => {
          mergedText += page.text + "\n\n";

          results.innerHTML += `
            <div class="card page">
              <div class="page-header">
                <strong>Page ${index + 1}: ${page.filename}</strong>
                <button type="button" class="secondary"
                  onclick="navigator.clipboard.writeText(this.parentElement.nextElementSibling.value)">
                  Copy
                </button>
              </div>
              <textarea>${page.text}</textarea>
            </div>
          `;
        });

        results.innerHTML =
          `
          <div class="card">
            <div class="page-header">
              <strong>üìÑ Merged Text</strong>
              <button type="button" class="secondary"
                onclick="navigator.clipboard.writeText(document.getElementById('merged').value)">
                Copy All
              </button>
            </div>
            <textarea id="merged" class="merged">${mergedText}</textarea>
          </div>
          ` + results.innerHTML;

      } catch (err) {
        status.textContent = "Failed to connect to backend";
        console.error(err);
      }
    }
  </script>
</body>
</html>